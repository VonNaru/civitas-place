<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Keranjang Belanja</title>
    <link rel="stylesheet" href="/static/css/cart.css">
    <link rel="stylesheet" href="/static/css/home.css">
</head>
<body>
    <header>
        <div class="container">
            <a href="/Home_pages.html"><img src="/static/pcture/Logo.png" alt=""></a>
            <nav>
                <a href="/Dasboard.html" style="text-decoration: none;"><button class="nav-button">Dashboard</button></a>
                <a href="/Cart.html" style="text-decoration: none;"><button class="nav-button cart">Keranjang</button></a>
                
                {% if session.get('user_name') %}
                <details class="user-menu-details">
                    <summary>{{ session.get('user_name') }} â–¼</summary>
                    <div class="dropdown-menu">
                        <a href="/Dasboard.html">ğŸ‘¤ Profil</a>
                        <form method="POST" action="/logout">
                            <button type="submit" class="logout-btn">ğŸšª Logout</button>
                        </form>
                    </div>
                </details>
                {% endif %}
            </nav>
        </div>
    </header>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flash-messages-container">
                {% for category, message in messages %}
                    <div class="flash-message {% if category == 'success' %}flash-success{% elif category == 'error' %}flash-error{% else %}flash-info{% endif %}">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <div class="cart-container">
        <h2>ğŸ›’ Keranjang Belanja</h2>
        
        {% if cart %}
            {% for item in cart %}
            <div class="cart-item">
                <div class="item-details">
                    <div class="item-name"><strong>{{ item.name }}</strong></div>
                    <div class="item-price">Harga: Rp {{ '{:,.0f}'.format(item.price) }}</div>
                    <div class="item-quantity">Jumlah: {{ item.quantity }}</div>
                    <div class="item-subtotal">Subtotal: Rp {{ '{:,.0f}'.format(item.price * item.quantity) }}</div>
                    {% if item.phone %}
                    <div class="item-contact">ğŸ“ Kontak: {{ item.phone }}</div>
                    {% endif %}
                </div>
                <div class="item-actions">
                    <form method="post" action="/remove_from_cart" style="display: inline;">
                        <input type="hidden" name="product_id" value="{{ item.product_id }}">
                        <button type="submit" class="remove-btn">ğŸ—‘ï¸ Hapus</button>
                    </form>
                </div>
            </div>
            {% endfor %}
            
            <div class="cart-total">
                <strong>Total: Rp {{ '{:,.0f}'.format(total) }}</strong>
            </div>
            
        {% else %}
            <div class="empty-cart">
                <div class="empty-icon">ğŸ›’</div>
                <h3>Keranjang belanja Anda masih kosong</h3>
                <p>Silakan pilih produk yang Anda inginkan</p>
            </div>
        {% endif %}
        
        <!-- âœ… PERBAIKAN: Hapus link yang rusak dan ganti dengan yang benar -->
        <div class="cart-actions">
            {% if cart %}
                <a href="{{ url_for('checkout.checkout') }}" class="checkout-btn">
                    ğŸ’³ Checkout (Rp {{ '{:,.0f}'.format(total) }})
                </a>
                <form method="POST" action="{{ url_for('cart.clear_cart') }}" style="display: inline;">
                    <button type="submit" class="clear-cart-btn" 
                            onclick="return confirm('Yakin ingin mengosongkan keranjang?')">
                        ğŸ—‘ï¸ Kosongkan Keranjang
                    </button>
                </form>
            {% else %}
                <a href="{{ url_for('pages.home_page') }}" class="continue-shopping">
                    ğŸ›ï¸ Lanjut Belanja
                </a>
            {% endif %}
        </div>
        
        <div class="back-to-shop">
            <a href="/Home_pages.html">â† Kembali ke Beranda</a>
        </div>
    </div>
</body>
</html>